name: staging

on:
   push:
      branches: ['staging']
   workflow_dispatch:

jobs:
   docker-frontend:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v2

         - uses: docker/login-action@v1
           name: Login to Docker Hub

           with:
              # generate some credentials from Dockerhub and store them into the repo secrets

              username: ${{ secrets.DOCKER_HUB_USERNAME }}

              password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
           # prepare buildx for docker

         - uses: docker/setup-buildx-action@v1

           name: Set up Docker Buildx

         # build an push the newly created image

         - uses: docker/build-push-action@v2

           name: Build and push

           with:
              context: ./client

              file: ./client/Dockerfile

              push: true

              tags: ${{ secrets.DOCKER_HUB_USERNAME }}/wns-deploy-client:latest

   docker-backend:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v2

         - uses: docker/login-action@v1
           name: Login to Docker Hub

           with:
              # generate some credentials from Dockerhub and store them into the repo secrets

              username: ${{ secrets.DOCKER_HUB_USERNAME }}

              password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
         # prepare buildx for docker

         - uses: docker/setup-buildx-action@v1

           name: Set up Docker Buildx

         # build an push the newly created image

         - uses: docker/build-push-action@v2

           name: Build and push

           with:
              context: ./client

              file: ./client/Dockerfile

              push: true

              tags: ${{ secrets.DOCKER_HUB_USERNAME }}/wns-deploy-server:latest
